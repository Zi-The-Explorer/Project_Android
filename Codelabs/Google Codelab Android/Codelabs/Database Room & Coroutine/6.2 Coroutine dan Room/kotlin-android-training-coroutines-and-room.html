<!doctype html>
<html 
      lang="id"
      dir="ltr">
  <head>
    <meta name="google-signin-client-id" content="721724668570-nbkv1cfusk7kk4eni4pjvepaus73b13t.apps.googleusercontent.com">
    <meta name="google-signin-scope"
          content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="Android Developers">
    <meta property="og:type" content="website"><meta name="robots" content="noindex"><meta name="theme-color" content="#3ddc84"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/_pwa/android/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="//www.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="//apis.google.com" crossorigin>
    <link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap">
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Material+Icons&display=block"><link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/css/app.css">
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/touchicon-180.png"><link rel="canonical" href="https://developer.android.com/codelabs/kotlin-android-training-coroutines-and-room?hl=id"><link rel="search" type="application/opensearchdescription+xml"
            title="Android Developers" href="https://developer.android.com/s/opensearch.xml">
      

<title>Android Kotlin Fundamentals: 6.2 Coroutines and Room</title>

<meta property="og:title" content="Android Kotlin Fundamentals: 6.2 Coroutines and Room"><meta name="description" content="Learn how to use Kotlin coroutines in your Android app to move database operations away from the main thread.">
  <meta property="og:description" content="Learn how to use Kotlin coroutines in your Android app to move database operations away from the main thread."><meta property="og:url" content="https://developer.android.com/codelabs/kotlin-android-training-coroutines-and-room?hl=id"><meta property="og:image" content="https://developer.android.com/images/social/android-developers.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image">
  <meta name="xsrf_token" content="qDi6tS9B37xwmSQ-HvG_Smu5wD5yEtMNHVhfEE2jXJ46MTYyNzQ4MjEzODI4MjUzNg">
  

  <meta name="session_expiry" content="1627483460">
  
    
    
    
    
    
    
      
    
    <meta name="original_source" content="https://docs.google.com/document/d/1Vm1rQjz-dJGWBKXfJAOIr94GAB9Ge2xH6JIY1S3C6eE/edit" />
    
    
    
    
    
      
    
    
      
    
    
  

    </head>
  <body class="devsite-full-width-page"
        template="codelab"
        theme="android-theme"
        type="codelab"
        
        layout="full"
        
        
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
  
    <section class="devsite-wrapper"><devsite-header>
  
    


























<div class="devsite-header--inner nocontent">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Open menu">
        </button>
        <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">

  <img src="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/lockup.svg" class="devsite-site-logo"
       alt="Android Developers">

</a>



  
  
  <span class="devsite-product-name">
    <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
  </span>

</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
              
              
  <devsite-tabs class="upper-tabs">

    <nav class="devsite-tabs-wrapper" aria-label="Tab atas">
      
        
          <tab  >
            <a href="https://developer.android.com/about"
   class="gc-analytics-event "
   track-type="nav"
   track-name="platform"
   track-metadata-eventdetail="https://developer.android.com/about"
   track-metadata-position="nav - platform"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Platform"
   >
  Platform
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/studio"
   class="gc-analytics-event "
   track-type="nav"
   track-name="android studio"
   track-metadata-eventdetail="https://developer.android.com/studio"
   track-metadata-position="nav - android studio"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Android Studio"
   >
  Android Studio
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/distribute"
   class="gc-analytics-event "
   track-type="nav"
   track-name="google play"
   track-metadata-eventdetail="https://developer.android.com/distribute"
   track-metadata-position="nav - google play"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Google Play"
   >
  Google Play
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/jetpack"
   class="gc-analytics-event "
   track-type="nav"
   track-name="jetpack"
   track-metadata-eventdetail="https://developer.android.com/jetpack"
   track-metadata-position="nav - jetpack"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Jetpack"
   >
  Jetpack
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/kotlin"
   class="gc-analytics-event "
   track-type="nav"
   track-name="kotlin"
   track-metadata-eventdetail="https://developer.android.com/kotlin"
   track-metadata-position="nav - kotlin"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Kotlin"
   >
  Kotlin
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/docs"
   class="gc-analytics-event "
   track-type="nav"
   track-name="dokumen"
   track-metadata-eventdetail="https://developer.android.com/docs"
   track-metadata-position="nav - dokumen"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Dokumen"
   >
  Dokumen
</a>

          </tab>
        
      
        
          <tab  >
            <a href="https://developer.android.com/news"
   class="gc-analytics-event "
   track-type="nav"
   track-name="berita"
   track-metadata-eventdetail="https://developer.android.com/news"
   track-metadata-position="nav - berita"
   track-metadata-module="primary nav"
   
   
     data-category="Site-Wide Custom Events"
   
     data-label="Tab: Berita"
   >
  Berita
</a>

          </tab>
        
      
    </nav>

  </devsite-tabs>

            
           </div>
          
<devsite-search
    aria-expanded="false"
    aria-haspopup="listbox"
    enable-signin
    enable-search
    enable-suggestions
      enable-query-completion
    
    project-name="Developer Android"
    tenant-name="Android Developers"
    
    
    
    
    
    role="combobox">
  <form class="devsite-search-form" action="https://developer.android.com/s/results" method="GET">
    <div class="devsite-search-container">
      <div class="devsite-searchbox">
        <input
          aria-activedescendant=""
          aria-autocomplete="list"
          
          aria-label="Penelusuran"
          aria-haspopup="false"
          aria-multiline="false"
          aria-label="Kotak penelusuran"
          autocomplete="off"
          class="devsite-search-field devsite-search-query"
          name="q"
          
          placeholder="Penelusuran"
          role="searchbox"
          type="text"
          value=""
          >
        <div class="devsite-search-image material-icons" aria-hidden="true"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              
              aria-label="Buka penelusuran"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          
          aria-label="Tutup penelusuran"></button>
</devsite-search>

        </div>

        

        

        
<devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    
    <select aria-label="Pilih preferensi bahasa Anda."
            class="devsite-language-selector-select"
            name="language"
            track-name="click"
            track-type="languageSelector">
    
    
      <option value="en"
              lang="en"
              track-metadata-original-language="id"
              track-metadata-selected-language="en"
              track-name="changed"
              track-type="languageSelector"
            >
        English
      </option>
    
      <option value="id"
              lang="id"
              track-metadata-original-language="id"
              track-metadata-selected-language="id"
              track-name="changed"
              track-type="languageSelector"
            
              selected="selected"
            >
        Bahasa Indonesia
      </option>
    
      <option value="es_419"
              lang="es_419"
              track-metadata-original-language="id"
              track-metadata-selected-language="es_419"
              track-name="changed"
              track-type="languageSelector"
            >
        Español – América Latina
      </option>
    
      <option value="pt_br"
              lang="pt_br"
              track-metadata-original-language="id"
              track-metadata-selected-language="pt_br"
              track-name="changed"
              track-type="languageSelector"
            >
        Português – Brasil
      </option>
    
      <option value="zh_cn"
              lang="zh_cn"
              track-metadata-original-language="id"
              track-metadata-selected-language="zh_cn"
              track-name="changed"
              track-type="languageSelector"
            >
        中文 – 简体
      </option>
    
      <option value="ja"
              lang="ja"
              track-metadata-original-language="id"
              track-metadata-selected-language="ja"
              track-name="changed"
              track-type="languageSelector"
            >
        日本語
      </option>
    
      <option value="ko"
              lang="ko"
              track-metadata-original-language="id"
              track-metadata-selected-language="ko"
              track-name="changed"
              track-type="languageSelector"
            >
        한국어
      </option>
    
    </select>
  </devsite-select>
</devsite-language-selector>


        

        
          
          
          <devsite-user signed-in
                        
                        
                          enable-profiles
                        
                        
                          
                        id="devsite-user"></devsite-user>
           
        
      </div>
    </div>
  </div>



  <div class="devsite-collapsible-section
    
      devsite-header-no-lower-tabs
    ">
    <div class="devsite-header-background">
      
        
      
      
    </div>
  </div>

</div>



  
</devsite-header>
      <devsite-book-nav scrollbars hidden>
        
          
























<nav class="devsite-book-nav devsite-nav nocontent"
     aria-label="Menu samping">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">

  <img src="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/lockup.svg" class="devsite-site-logo" alt="Android Developers">

</a>


  
      <span class="devsite-product-name">
        
        
        <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
      </span>
    

</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
            <li class="devsite-nav-item">
              
  
  <a href="/about"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Platform"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="platform">
  
    <span class="devsite-nav-text" tooltip >
      Platform
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/studio"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Android Studio"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="androidStudio">
  
    <span class="devsite-nav-text" tooltip >
      Android Studio
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/distribute"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Google Play"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="googlePlay">
  
    <span class="devsite-nav-text" tooltip >
      Google Play
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/jetpack"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Jetpack"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="jetpack">
  
    <span class="devsite-nav-text" tooltip >
      Jetpack
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/kotlin"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Kotlin"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="kotlin">
  
    <span class="devsite-nav-text" tooltip >
      Kotlin
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/docs"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Dokumen"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="dokumen">
  
    <span class="devsite-nav-text" tooltip >
      Dokumen
   </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/news"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Berita"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav"
     track-name="berita">
  
    <span class="devsite-nav-text" tooltip >
      Berita
   </span>
    
  
  </a>
  

  
              
            </li>
          
          
          
        </ul>
      
    </div>
    
  </div>
</nav>
        
      </devsite-book-nav>
      <section id="gc-wrapper">
        <main role="main" class="devsite-main-content"
            
            >
          
          <devsite-toc class="devsite-nav"
                       role="navigation"
                       aria-label="Daftar isi"
            disabled></devsite-toc>
          <devsite-content>
            
              

















<article class="devsite-article"><style>
      body {
        transition: opacity ease-in 0.2s;
      }

      body[unresolved] {
        opacity: 0;
        display: block;
        overflow: hidden;
        position: relative;
      }
      </style>
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://developer.android.com/"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Breadcrumbs"
      
        data-value="1"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="1"
      
        track-metadata-eventdetail="Developer Android"
      
    >
    
        Developer Android
      
  </a>
  
    
  </li>
  
</ul>
    
  </div>
  
  
    <h1 class="devsite-page-title">Android Kotlin Fundamentals: 6.2 Coroutines and Room</h1><devsite-bookmark></devsite-bookmark>
  

  <devsite-toc class="devsite-nav" devsite-toc-embedded
               disabled>
  </devsite-toc>

  

  <div class="devsite-article-body clearfix
    ">

    
      
    <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
    <google-codelab codelab-gaid="UA-81734179-1"
                    doc-id="1Vm1rQjz-dJGWBKXfJAOIr94GAB9Ge2xH6JIY1S3C6eE"
                    id="kotlin-android-training-coroutines-and-room"
                    title="Android Kotlin Fundamentals: 6.2 Coroutines and Room"
                    environment="web"
                    category="android,kotlin"
                    feedback-link="https://github.com/google-developer-training/android-kotlin-fundamentals-apps/issues/new?assignees=&amp;labels=&amp;template=android-kotlin-fundamentals.md&amp;title=Android&#43;Kotlin&#43;Fundamentals&#43;codelab%3A&#43;"
                    >
      
        <google-codelab-step label="Welcome" duration="0">
          
            <google-codelab-about codelab-title="Android Kotlin Fundamentals: 6.2 Coroutines and Room"
                                  authors="Google Developers Training team"
                                  >
            </google-codelab-about>
          
          <p>This codelab is part of the Android Kotlin Fundamentals course. You&#39;ll get the most value out of this course if you work through the codelabs in sequence. All the course codelabs are listed on the  <a href="https://codelabs.developers.google.com/android-kotlin-fundamentals/" target="_blank">Android Kotlin Fundamentals codelabs landing page</a>.</p>
<h2 is-upgraded id="introduction" data-text="Introduction">Introduction</h2>
<p>One of the top priorities for creating a flawless user experience is ensuring the UI of your app is always responsive and running smoothly.  To deliver this experience, we can improve UI performance by moving long-running tasks, such as database operations, into the background.</p>
<p>In this codelab, you implement the user-facing portion of the TrackMySleepQuality app, using Kotlin coroutines to perform database operations away from the main thread.</p>
<h2 is-upgraded id="what-you-should-already-know" data-text="What you should already know">What you should already know</h2>
<p>You should be familiar with:</p>
<ul>
<li>Building a basic user interface (UI) using an activity, fragments, views, and click handlers.</li>
<li>Navigating between fragments, and using <code translate="no" dir="ltr">safeArgs</code> to pass simple data between fragments.</li>
<li>View models, view model factories, transformations, and <code translate="no" dir="ltr">LiveData</code>.</li>
<li>How to create a <code translate="no" dir="ltr">Room</code> database, create a DAO, and define entities.</li>
<li>Basic threading and multiprocessing concepts.</li>
</ul>
<h2 class="checklist" is-upgraded id="what-youll-learn" data-text="What you'll learn">What you'll learn</h2>
<ul class="checklist">
<li>How threads work in Android.</li>
<li>How to use Kotlin coroutines to move database operations away from the main thread.</li>
<li>How to display formatted data in a <code translate="no" dir="ltr">TextView</code>.</li>
</ul>
<h2 is-upgraded id="what-youll-do" data-text="What you'll do">What you'll do</h2>
<ul>
<li>Extend the TrackMySleepQuality app to collect, store, and display data in and from the database.</li>
<li>Use coroutines to run long-running database operations in the background.</li>
<li>Use <code translate="no" dir="ltr">LiveData</code> to trigger navigation and the display of a snackbar.</li>
<li>Use <code translate="no" dir="ltr">LiveData</code> to enable and disable buttons.</li>
</ul>


        </google-codelab-step>
      
        <google-codelab-step label="App overview" duration="0">
          
          <p>In this codelab, you build the view model, coroutines, and data-display portions of the TrackMySleepQuality app.</p>
<p>The app has two screens, represented by fragments, as shown in the figure below.</p>
<p class="image-container"><img alt="WTsRlkiNXXQ7fe3myuNV8SigzmETej7zu35m_x7VEPJNGUwKLNrSFg1k7RPur1Y6tvMcInSIKbeHysH-AvR2MYoJCkOsHWBpgyQ6ut4Bvmxa5tpX9NVMIv7lc-7gDLTw4dUSV7wFkQ" style="width: 624.00px" src="https://lh4.googleusercontent.com/WTsRlkiNXXQ7fe3myuNV8SigzmETej7zu35m_x7VEPJNGUwKLNrSFg1k7RPur1Y6tvMcInSIKbeHysH-AvR2MYoJCkOsHWBpgyQ6ut4Bvmxa5tpX9NVMIv7lc-7gDLTw4dUSV7wFkQ"></p>
<p>The first screen, shown on the left, has buttons to start and stop tracking. The screen shows all the user&#39;s sleep data. The <strong>Clear</strong> button permanently deletes all the data that the app has collected for the user.</p>
<p>The second screen, shown on the right, is for selecting a sleep-quality rating. In the app, the rating is represented numerically. For development purposes, the app shows both the face icons and their numerical equivalents.</p>
<p>The user&#39;s flow is as follows:</p>
<ul>
<li>User opens the app and is presented with the sleep-tracking screen.</li>
<li>User taps the <strong>Start</strong> button. This records the starting time and displays it. The <strong>Start</strong> button is disabled, and the <strong>Stop</strong> button is enabled.</li>
<li>User taps the <strong>Stop</strong> button. This records the ending time and opens the sleep-quality screen.</li>
<li>User selects a sleep-quality icon. The screen closes, and the tracking screen displays the sleep-ending time and sleep quality. The <strong>Stop</strong> button is disabled and the <strong>Start</strong> button is enabled. The app is ready for another night.</li>
<li>The <strong>Clear</strong> button is enabled whenever there is data in the database. When the user taps the <strong>Clear</strong> button, all their data is erased without recourse—there is no &#34;Are you sure?&#34; message.</li>
</ul>
<p>This app uses a simplified architecture, as shown below in the context of the full architecture. The app uses only the following components:</p>
<ul>
<li>UI controller</li>
<li>View model and <code translate="no" dir="ltr">LiveData</code></li>
<li>A Room database</li>
</ul>
<p class="image-container"><img alt="Q7-Cq9-Y4h13EbiYcZR---sZ74dgkqejB699RY7cCIxGresnPfPKHqjX8HsTVB24r-c3gqRAgWUrERqjraXtQPpdCZ-ZeJhtUHw9s2-j39pW9Cerk0Qethe_Pc3oOy0hVl-q9i47Xg" style="width: 624.00px" src="https://lh5.googleusercontent.com/Q7-Cq9-Y4h13EbiYcZR---sZ74dgkqejB699RY7cCIxGresnPfPKHqjX8HsTVB24r-c3gqRAgWUrERqjraXtQPpdCZ-ZeJhtUHw9s2-j39pW9Cerk0Qethe_Pc3oOy0hVl-q9i47Xg"></p>


        </google-codelab-step>
      
        <google-codelab-step label="Task: Inspect the starter code" duration="0">
          
          <p>In this task, you use a <code translate="no" dir="ltr">TextView</code> to display formatted sleep tracking data. (This is not the final user interface. You will improve the UI in another codelab.)</p>
<p>You can continue with the TrackMySleepQuality app that you built in the previous codelab or download the  <a href="https://github.com/google-developer-training/android-kotlin-fundamentals-starter-apps/tree/master/TrackMySleepQualityCoroutines-Starter" target="_blank">starter app for this codelab</a>.</p>
<h2 is-upgraded id="step-1:-download-and-run-the-starter-app" data-text="Step 1: Download and run the starter app">Step 1: Download and run the starter app</h2>
<ol type="1">
<li>Download the  <a href="https://github.com/google-developer-training/android-kotlin-fundamentals-starter-apps/tree/master/TrackMySleepQualityCoroutines-Starter" target="_blank">TrackMySleepQuality-Coroutines-Starter</a> app from GitHub.</li>
<li>Build and run the app. The app shows the UI for the <code translate="no" dir="ltr">SleepTrackerFragment</code> fragment, but no data. The buttons do not respond to taps.</li>
</ol>
<h2 is-upgraded id="step-2:-inspect-the-code" data-text="Step 2: Inspect the code">Step 2: Inspect the code</h2>
<p>The starter code for this codelab is the same as the  <a href="https://github.com/google-developer-training/android-kotlin-fundamentals-apps/tree/master/TrackMySleepQualityRoomAndTesting" target="_blank">solution code for the Create a Room Database codelab</a>.</p>
<ol type="1">
<li>Open <strong>res/layout/activity_main.xml.</strong> This layout contains the <code translate="no" dir="ltr">nav_host_fragment</code> fragment. Also, notice the <code translate="no" dir="ltr">&lt;merge&gt;</code> tag. The <code translate="no" dir="ltr">merge</code> tag can be used to eliminate redundant layouts when including layouts, and it&#39;s a good idea to use it. An example of a redundant layout would be ConstraintLayout &gt; LinearLayout &gt; TextView, where the system might be able to eliminate the LinearLayout. This kind of optimization can simplify the view hierarchy and improve app performance.</li>
<li>In the <strong>navigation</strong> folder, open <strong>navigation.xml</strong>. You can see two fragments and the navigation actions that connect them.</li>
<li>In the <strong>layout</strong> folder, open <strong>fragment_sleep_tracker.xml</strong> and click on the <strong>Code</strong> view to see its XML layout. Notice the following:</li>
</ol>
<ul>
<li>The layout data is wrapped in a <code translate="no" dir="ltr">&lt;layout&gt;</code> element to enable data binding.</li>
<li><code translate="no" dir="ltr">ConstraintLayout</code> and the other views are arranged inside the <code translate="no" dir="ltr">&lt;layout&gt;</code> element.</li>
<li>The file has a placeholder <code translate="no" dir="ltr">&lt;data&gt;</code> tag.</li>
</ul>
<p>The starter app also provides dimensions, colors, and styling for the UI. The app contains a <code translate="no" dir="ltr">Room</code> database, a DAO, and a <code translate="no" dir="ltr">SleepNight</code> entity. If you did not complete the preceding &#34;Create a Room Database&#34; codelab, make sure you explore these aspects of the code on your own.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Task: Add a ViewModel" duration="0">
          
          <p>Now that you have a database and a UI, you need to collect data, add the data to the database, and display the data. All this work is done in the view model. Your sleep-tracker view model will handle button clicks, interact with the database via the DAO, and provide data to the UI via <code translate="no" dir="ltr">LiveData</code>. All database operations will have to be run away from the main UI thread, and you&#39;ll do that using coroutines.</p>
<h2 is-upgraded id="step-1:-add-sleeptrackerviewmodel" data-text="Step 1: Add SleepTrackerViewModel">Step 1: Add SleepTrackerViewModel</h2>
<ol type="1">
<li>In the <strong>sleeptracker</strong> package, open <strong>SleepTrackerViewModel.kt</strong>.</li>
<li>Inspect the <code translate="no" dir="ltr">SleepTrackerViewModel</code> class, which is provided for you in the starter app and is also shown below.  Note that the class extends <code translate="no" dir="ltr">AndroidViewModel</code>. This class is the same as <code translate="no" dir="ltr">ViewModel</code>, but it takes the application context as a constructor parameter and makes it available as a property. You will need this later.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">class SleepTrackerViewModel(
       val database: SleepDatabaseDao,
       application: Application) : AndroidViewModel(application) {
}
</code></pre>
<h2 is-upgraded id="step-2:-add-sleeptrackerviewmodelfactory" data-text="Step 2: Add SleepTrackerViewModelFactory">Step 2: Add SleepTrackerViewModelFactory</h2>
<ol type="1">
<li>In the <strong>sleeptracker</strong> package, open <strong>SleepTrackerViewModelFactory.kt.</strong></li>
<li>Examine the code that&#39;s provided for you for the factory, which is shown below:</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">class SleepTrackerViewModelFactory(
       private val dataSource: SleepDatabaseDao,
       private val application: Application) : ViewModelProvider.Factory {
   @Suppress(&#34;unchecked_cast&#34;)
   override fun &lt;T : ViewModel?&gt; create(modelClass: Class&lt;T&gt;): T {
       if (modelClass.isAssignableFrom(SleepTrackerViewModel::class.java)) {
           return SleepTrackerViewModel(dataSource, application) as T
       }
       throw IllegalArgumentException(&#34;Unknown ViewModel class&#34;)
   }
}
</code></pre>
<p>Take note of the following:</p>
<ul>
<li>The provided <code translate="no" dir="ltr">SleepTrackerViewModelFactory</code> takes the same argument as the <code translate="no" dir="ltr">ViewModel</code> and extends <code translate="no" dir="ltr">ViewModelProvider.Factory</code>.</li>
<li>Inside the factory, the code overrides <code translate="no" dir="ltr">create()</code>, which takes any class type as an argument and returns a <code translate="no" dir="ltr">ViewModel</code>.</li>
<li>In the body of <code translate="no" dir="ltr">create()</code>, the code checks that there is a <code translate="no" dir="ltr">SleepTrackerViewModel</code> class available, and if there is, returns an instance of it. Otherwise, the code throws an exception.</li>
</ul>
<aside class="special"><p><strong>Tip:</strong> This is mostly boilerplate code, so you can reuse the code for future view-model factories.</p>
</aside>
<h2 is-upgraded id="step-3:-update-sleeptrackerfragment" data-text="Step 3: Update SleepTrackerFragment">Step 3: Update SleepTrackerFragment</h2>
<ol type="1">
<li>In <code translate="no" dir="ltr">SleepTrackerFragment.kt</code>, get a reference to the application context. Put the reference in <code translate="no" dir="ltr">onCreateView()</code>, below <code translate="no" dir="ltr">binding</code>. You need a reference to the app that this fragment is attached to, to pass into the view-model factory provider.</li>
</ol>
<p>The <code translate="no" dir="ltr">requireNotNull</code> Kotlin function throws an  <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-illegal-argument-exception/index.html#kotlin.IllegalArgumentException" target="_blank"><code translate="no" dir="ltr">IllegalArgumentException</code></a> if the  <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/require-not-null.html#kotlin%24requireNotNull%28kotlin.requireNotNull.T%29%2Fvalue" target="_blank">value</a> is <code translate="no" dir="ltr">null</code>.</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">val application = requireNotNull(this.activity).application
</code></pre>
<ol type="1" start="2">
<li>You need a reference to your data source via a reference to the DAO. In <code translate="no" dir="ltr">onCreateView()</code>, before the <code translate="no" dir="ltr">return</code>, define a <code translate="no" dir="ltr">dataSource</code>. To get a reference to the DAO of the database, use <code translate="no" dir="ltr">SleepDatabase.getInstance(application).sleepDatabaseDao</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">val dataSource = SleepDatabase.getInstance(application).sleepDatabaseDao
</code></pre>
<ol type="1" start="3">
<li>In <code translate="no" dir="ltr">onCreateView()</code>, before the <code translate="no" dir="ltr">return</code>, create an instance of the <code translate="no" dir="ltr">viewModelFactory</code>. You need to pass it <code translate="no" dir="ltr">dataSource</code> and the <code translate="no" dir="ltr">application</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">val viewModelFactory = SleepTrackerViewModelFactory(dataSource, application)
</code></pre>
<ol type="1" start="4">
<li>Now that you have a factory, get a reference to the <code translate="no" dir="ltr">SleepTrackerViewModel</code>. The <code translate="no" dir="ltr">SleepTrackerViewModel::class.java</code> parameter refers to the runtime Java class of this object.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">val sleepTrackerViewModel =
       ViewModelProvider(
               this, viewModelFactory).get(SleepTrackerViewModel::class.java)
</code></pre>
<ol type="1" start="5">
<li>Your finished code should look like this:</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">// Create an instance of the ViewModel Factory.
val dataSource = SleepDatabase.getInstance(application).sleepDatabaseDao
val viewModelFactory = SleepTrackerViewModelFactory(dataSource, application)

// Get a reference to the ViewModel associated with this fragment.
val sleepTrackerViewModel =
       ViewModelProvider(
               this, viewModelFactory).get(SleepTrackerViewModel::class.java)
</code></pre>
<p>Here&#39;s the <code translate="no" dir="ltr">onCreateView()</code> method so far:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,
                              savedInstanceState: Bundle?): View? {

        // Get a reference to the binding object and inflate the fragment views.
        val binding: FragmentSleepTrackerBinding = DataBindingUtil.inflate(
                inflater, R.layout.fragment_sleep_tracker, container, false)

        val application = requireNotNull(this.activity).application

        val dataSource = SleepDatabase.getInstance(application).sleepDatabaseDao

        val viewModelFactory = SleepTrackerViewModelFactory(dataSource, application)

        val sleepTrackerViewModel =
                ViewModelProvider(
                        this, viewModelFactory).get(SleepTrackerViewModel::class.java)

        return binding.root
    }
</code></pre>
<h2 is-upgraded id="step-4:-add-data-binding-for-the-view-model" data-text="Step 4: Add data binding for the view model">Step 4: Add data binding for the view model</h2>
<p>With the basic <code translate="no" dir="ltr">ViewModel</code> in place, you need to finish setting up data binding in the <code translate="no" dir="ltr">SleepTrackerFragment</code> to connect the <code translate="no" dir="ltr">ViewModel</code> with the UI.</p>
<p>In the <code translate="no" dir="ltr">fragment_sleep_tracker.xml</code> layout file:</p>
<ol type="1">
<li>Inside the <code translate="no" dir="ltr">&lt;data&gt;</code> section, create a <code translate="no" dir="ltr">&lt;variable&gt;</code> that references the <code translate="no" dir="ltr">SleepTrackerViewModel</code> class.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">&lt;data&gt;
   &lt;variable
       name=&#34;sleepTrackerViewModel&#34;
       type=&#34;com.example.android.trackmysleepquality.sleeptracker.SleepTrackerViewModel&#34; /&gt;
&lt;/data&gt;
</code></pre>
<p>In <code translate="no" dir="ltr">SleepTrackerFragment.kt</code>:</p>
<ol type="1">
<li>Set the current activity as the lifecycle owner of the binding. Add this code inside the <code translate="no" dir="ltr">onCreateView()</code> method, before the <code translate="no" dir="ltr">return</code> statement:</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">binding.setLifecycleOwner(this)
</code></pre>
<ol type="1" start="2">
<li>Assign the <code translate="no" dir="ltr">sleepTrackerViewModel</code> binding variable to the <code translate="no" dir="ltr">sleepTrackerViewModel</code>. Put this code inside <code translate="no" dir="ltr">onCreateView()</code>, below the code that creates the <code translate="no" dir="ltr">SleepTrackerViewModel</code>:</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">binding.sleepTrackerViewModel = sleepTrackerViewModel
</code></pre>
<ol type="1" start="3">
<li>You may see an error, because you have to recreate the binding object. Clean and rebuild the project to get rid of the error.</li>
<li>Finally, as always, make sure your code builds and runs without errors.</li>
</ol>


        </google-codelab-step>
      
        <google-codelab-step label="Concept: Coroutines" duration="0">
          
          <aside class="special"><p><strong>Note:</strong> An application may be prevented from executing normally if it has to wait for a task to complete before it can continue. For example, reading a large file or  performing a lengthy database call would be tasks that might prevent, or &#34;block&#34;, execution of the overall app.  Not only does this reduce application responsiveness to the user but it also doesn&#39;t make efficient use of the hardware. One pattern for executing long-running tasks without blocking the main thread is to use  <a href="https://en.wikipedia.org/wiki/Callback_(computer_programming)" target="_blank">callbacks</a>. This is a useful pattern, but it has some disadvantages. See the  <a href="https://developer.android.com/courses/extras/multithreading" target="_blank">Multi-threading &amp; callbacks primer</a> for an introduction to these concepts.</p>
</aside>
<p>In Kotlin, coroutines are the way to handle long-running tasks elegantly and efficiently instead of callbacks.  Kotlin coroutines let you convert callback-based code to sequential code. Code written sequentially is typically easier to read and maintain.  Unlike callbacks, coroutines can safely use valuable language features such as exceptions.  And most importantly coroutines have a higher degree of maintainability and flexibility. In the end, coroutines and callbacks perform the same functionality: they are both ways of handling potentially long-running asynchronous tasks within an app.</p>
<p class="image-container"><img alt="952b19bd8601a7a5.png" style="width: 325.99px" src="/codelabs/kotlin-android-training-coroutines-and-room/img/952b19bd8601a7a5.png"></p>
<p>Coroutines have the following properties:</p>
<ul>
<li>Coroutines are asynchronous and non-blocking.</li>
<li>Coroutines use <em>suspend</em> functions to make asynchronous code sequential.</li>
</ul>
<h3 is-upgraded id="coroutines-are-asynchronous." data-text="Coroutines are asynchronous.">Coroutines are asynchronous.</h3>
<p>A coroutine runs independently from the main execution steps of your program. This could be in parallel or on a separate processor. It could also be that while the rest of the app is waiting for input, you sneak in a bit of processing. One of the important aspects of asynchronous programming is you cannot expect the result to be immediately available, until you explicitly wait for it.</p>
<p>For example, let&#39;s say you have a question that requires research, and you politely request to ask a colleague to find the answer. Your colleague  then starts to work on it by themselves. You can continue to do other unrelated work that doesn&#39;t depend on the answer until your colleague returns with an answer. In this example, your colleague is doing the work asynchronously &#34;on a separate thread&#34;.</p>
<h3 is-upgraded id="coroutines-are-non-blocking." data-text="Coroutines are non-blocking.">Coroutines are non-blocking.</h3>
<p><em>Non-blocking</em> means that a coroutine does not block, or interfere with the progress of the main or UI thread. So with coroutines, users can have the smoothest possible experience, because the UI interaction, which is run on the main thread, always has priority.</p>
<h3 is-upgraded id="coroutines-use-suspend-functions-to-make-asynchronous-code-sequential." data-text="Coroutines use suspend functions to make asynchronous code sequential.">Coroutines use suspend functions to make asynchronous code sequential.</h3>
<p>The keyword <code translate="no" dir="ltr">suspend</code> is Kotlin&#39;s way of marking a function, or function type, as being available to coroutines. When a coroutine calls a function marked with <code translate="no" dir="ltr">suspend</code>, instead of blocking until the function returns like a normal function call, the coroutine suspends execution until the result is ready. Then the coroutine resumes where it left off, with the result.</p>
<p>While the coroutine is suspended and waiting for a result, it unblocks the thread that it&#39;s running on. That way, other functions or coroutines can run.</p>
<p>The <code translate="no" dir="ltr">suspend</code> keyword doesn&#39;t specify the thread that the code runs on. A suspend function may run on a background thread, or on the main thread.</p>
<aside class="special"><p><strong>Tip:</strong> The difference between <em>blocking</em> and <em>suspending</em> is that if a thread is blocked, no other work happens. If the thread is suspended, other work happens until the result is available.</p>
</aside>
<p class="image-container"><img alt="ce77d98e12909f3e.png" style="width: 380.50px" src="/codelabs/kotlin-android-training-coroutines-and-room/img/ce77d98e12909f3e.png"></p>
<p>To use coroutines in Kotlin, you need three things:</p>
<ul>
<li>A job</li>
<li>A dispatcher</li>
<li>A scope</li>
</ul>
<p><strong>Job</strong>: Basically, a job is anything that can be canceled. Every coroutine has a job, and you can use the job to cancel the coroutine. Jobs can be arranged into parent-child hierarchies. Canceling a parent job immediately cancels all the job&#39;s children, which is a lot more convenient than canceling each coroutine manually.</p>
<p><strong>Dispatcher:</strong> The dispatcher sends off coroutines to run on various threads. For example, <code translate="no" dir="ltr">Dispatchers.Main</code> runs tasks on the main thread, and <code translate="no" dir="ltr">Dispatchers.IO</code> offloads blocking I/O tasks to a shared pool of threads.</p>
<p><strong>Scope:</strong> A coroutine&#39;s <em>scope</em> defines the context in which the coroutine runs. A scope combines information about a coroutine&#39;s job and dispatchers. Scopes keep track of coroutines. When you launch a coroutine, it&#39;s &#34;in a scope,&#34; which means that you&#39;ve indicated which scope will keep track of the coroutine.</p>
<h3 is-upgraded id="kotlin-coroutines-with-architecture-components" data-text="Kotlin coroutines with Architecture components">Kotlin coroutines with Architecture components</h3>
<p>A  <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/" target="_blank"><code translate="no" dir="ltr">CoroutineScope</code></a> keeps track of all your coroutines and helps you to manage when your coroutines should run. It can also cancel all of the coroutines started within it. Each asynchronous operation or coroutine runs within a particular <code translate="no" dir="ltr">CoroutineScope</code>.</p>
<p><a href="https://developer.android.com/topic/libraries/architecture?authuser=1" target="_blank">Architecture components</a> provide first-class support for coroutines for logical scopes in your app. Architecture components define the following built-in scopes that you can use in your app. The built-in coroutine scopes are in the  <a href="https://developer.android.com/kotlin/ktx?authuser=1" target="_blank">KTX extensions</a> for each corresponding Architecture component. Be sure to add the appropriate dependencies when using these scopes.</p>
<ul>
<li><a href="https://developer.android.com/topic/libraries/architecture/coroutines?authuser=1#viewmodelscope" target="_blank"><code translate="no" dir="ltr">ViewModelScope</code></a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/coroutines?authuser=1#lifecyclescope" target="_blank"><code translate="no" dir="ltr">LifecycleScope</code></a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/coroutines?authuser=1#livedata" target="_blank"><code translate="no" dir="ltr">liveData</code></a></li>
</ul>
<p><a href="https://developer.android.com/topic/libraries/architecture/coroutines?authuser=1#viewmodelscope" target="_blank"><code translate="no" dir="ltr">ViewModelScope</code></a>: A <code translate="no" dir="ltr">ViewModelScope</code> is defined for each  <a href="https://developer.android.com/topic/libraries/architecture/viewmodel?authuser=1" target="_blank"><code translate="no" dir="ltr">ViewModel</code></a> in your app. Any coroutine launched in this scope is automatically canceled if the <code translate="no" dir="ltr">ViewModel</code> is cleared. In this codelab you will use <code translate="no" dir="ltr">ViewModelScope</code> to initiate the database operations.</p>
<h3 is-upgraded id="room-and-dispatcher" data-text="Room and Dispatcher">Room and Dispatcher</h3>
<p>When using the Room library to perform a database operation, Room uses a <code translate="no" dir="ltr">Dispatchers.IO</code> to perform the database operations in a background thread. You don&#39;t have to explicitly specify any <code translate="no" dir="ltr">Dispatchers</code>.  Room does this for you.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Task: Collect and display the data" duration="0">
          
          <p>You want the user to be able to interact with the sleep data in the following ways:</p>
<ul>
<li>When the user taps the <strong>Start</strong> button, the app creates a new sleep night and stores the sleep night in the database.</li>
<li>When the user taps the <strong>Stop</strong> button, the app updates the night with an end time.</li>
<li>When the user taps the <strong>Clear</strong> button, the app erases the data in the database.</li>
</ul>
<p>These database operations can take a long time, so they should run on a separate thread.</p>
<h2 is-upgraded id="step-1:-mark-dao-functions-as-suspend-functions" data-text="Step 1: Mark DAO functions as suspend functions">Step 1: Mark DAO functions as suspend functions</h2>
<p>In <code translate="no" dir="ltr">SleepDatabaseDao.kt</code>, change the convenience methods to suspend functions.</p>
<ol type="1">
<li>Open <code translate="no" dir="ltr">database/SleepDatabaseDao.kt</code>, add suspend keyword to all the methods except for <code translate="no" dir="ltr">getAllNights()</code> because Room already uses a background thread for that specific  @Query which returns LiveData.  The complete <code translate="no" dir="ltr">SleepDatabaseDao</code> class will look like this.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">@Dao
interface SleepDatabaseDao {

   @Insert
   suspend fun insert(night: SleepNight)

   @Update
   suspend fun update(night: SleepNight)

   @Query(&#34;SELECT * from daily_sleep_quality_table WHERE nightId = :key&#34;)
   suspend fun get(key: Long): SleepNight?

   @Query(&#34;DELETE FROM daily_sleep_quality_table&#34;)
   suspend fun clear()

   @Query(&#34;SELECT * FROM daily_sleep_quality_table ORDER BY nightId DESC LIMIT 1&#34;)
   suspend fun getTonight(): SleepNight?

   @Query(&#34;SELECT * FROM daily_sleep_quality_table ORDER BY nightId DESC&#34;)
   fun getAllNights(): LiveData&lt;List&lt;SleepNight&gt;&gt;
}
</code></pre>
<h2 is-upgraded id="step-2:-set-up-coroutines-for-database-operations" data-text="Step 2: Set up coroutines for database operations">Step 2: Set up coroutines for database operations</h2>
<p>When the <strong>Start</strong> button in the Sleep Tracker app is tapped, you want to call a function in the <code translate="no" dir="ltr">SleepTrackerViewModel</code> to create a new instance of <code translate="no" dir="ltr">SleepNight</code> and store the instance in the database.</p>
<p>Tapping any of the buttons triggers a database operation, such as creating or updating a <code translate="no" dir="ltr">SleepNight</code>. Since database operations can take a while, you use coroutines to implement click handlers for the app&#39;s buttons.</p>
<ol type="1">
<li>Open the app-level <code translate="no" dir="ltr">build.gradle</code> file. Under the dependencies section, you need the following dependencies, which were added for you.</li>
</ol>
<pre translate="no" dir="ltr">implementation &#34;androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0&#34;

// Kotlin Extensions and Coroutines support for Room
implementation &#34;androidx.room:room-ktx:$room_version&#34;
</pre>
<ol type="1" start="2">
<li>Open the <code translate="no" dir="ltr">SleepTrackerViewModel.kt</code> file.</li>
<li>Define a variable called <code translate="no" dir="ltr">tonight</code> to hold the current night. Make the variable <code translate="no" dir="ltr">MutableLiveData</code>, because you need to be able to observe the data and change it.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private var tonight = MutableLiveData&lt;SleepNight?&gt;()
</code></pre>
<ol type="1" start="4">
<li>To initialize the <code translate="no" dir="ltr">tonight</code> variable as soon as possible, create an <code translate="no" dir="ltr">init</code> block below the definition of <code translate="no" dir="ltr">tonight</code> and call <code translate="no" dir="ltr">initializeTonight()</code>. You define <code translate="no" dir="ltr">initializeTonight()</code> in the next step.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">init {
   initializeTonight()
}
</code></pre>
<ol type="1" start="5">
<li>Below the <code translate="no" dir="ltr">init</code> block, implement <code translate="no" dir="ltr">initializeTonight()</code>. Use  the <code translate="no" dir="ltr">viewModelScope.launch</code> to start a coroutine in the <code translate="no" dir="ltr">ViewModelScope</code>. Inside the curly braces, get the value for <code translate="no" dir="ltr">tonight</code> from the database by calling <code translate="no" dir="ltr">getTonightFromDatabase()</code>, and assign the value to <code translate="no" dir="ltr">tonight.value</code>. You define <code translate="no" dir="ltr">getTonightFromDatabase()</code> in the next step.</li>
</ol>
<p>Notice the use of curly braces for <strong><code translate="no" dir="ltr">launch</code></strong>.  They are defining a lambda expression, which is a function without a name.  In this example, you are passing in a lambda to the <strong><code translate="no" dir="ltr">launch</code></strong> coroutine builder.  This builder creates a coroutine and assigns the execution of that lambda to the corresponding dispatcher.</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private fun initializeTonight() {
   viewModelScope.launch {
       tonight.value = getTonightFromDatabase()
   }
}
</code></pre>
<ol type="1" start="6">
<li>Implement <code translate="no" dir="ltr">getTonightFromDatabase()</code>. Define it as a <code translate="no" dir="ltr">private suspend</code> function that returns a nullable <code translate="no" dir="ltr">SleepNight</code>, if there is no current started <code translate="no" dir="ltr">SleepNight</code>. This leaves you with an error, because the function has to return something.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private suspend fun getTonightFromDatabase(): SleepNight? { }
</code></pre>
<ol type="1" start="7">
<li>Inside the function body of <code translate="no" dir="ltr">getTonightFromDatabase()</code>, get <code translate="no" dir="ltr">tonight</code> (the newest night) from the database. If the start and end times are not the same, meaning that the night has already been completed, return <code translate="no" dir="ltr">null</code>. Otherwise, return the night.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">       var night = database.getTonight()
       if (night?.endTimeMilli != night?.startTimeMilli) {
           night = null
       }
       return night
</code></pre>
<p>Your completed <code translate="no" dir="ltr">getTonightFromDatabase()</code> <code translate="no" dir="ltr">suspend</code> function should look like this. There should be no more errors.</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private suspend fun getTonightFromDatabase(): SleepNight? {
    var night = database.getTonight()
    if (night?.endTimeMilli != night?.startTimeMilli) {
        night = null
    }
    return night
}
</code></pre>
<h2 is-upgraded id="step-3:-add-the-click-handler-for-the-start-button" data-text="Step 3: Add the click handler for the Start button">Step 3: Add the click handler for the Start button</h2>
<p>Now you can implement <code translate="no" dir="ltr">onStartTracking()</code>, the click handler for the <strong>Start</strong> button. You  need to create a new <code translate="no" dir="ltr">SleepNight</code>, insert it into the database, and assign it to <code translate="no" dir="ltr">tonight</code>. The structure of <code translate="no" dir="ltr">onStartTracking()</code> is going to be similar to <code translate="no" dir="ltr">initializeTonight()</code>.</p>
<ol type="1">
<li>In <code translate="no" dir="ltr">SleepTrackerViewModel.kt</code>, start with the function definition for <code translate="no" dir="ltr">onStartTracking()</code>. You can put the click handlers below <code translate="no" dir="ltr">getTonightFromDatabase()</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">fun onStartTracking() {}
</code></pre>
<ol type="1" start="2">
<li>Inside <code translate="no" dir="ltr">onStartTracking()</code>, launch a coroutine in the <em><code translate="no" dir="ltr">viewModelScope</code></em>, because you need this result to continue and update the UI.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">viewModelScope.launch {}
</code></pre>
<ol type="1" start="3">
<li>Inside the coroutine launch, create a new <code translate="no" dir="ltr">SleepNight</code>,  which captures the current time as the start time.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">        val newNight = SleepNight()
</code></pre>
<ol type="1" start="4">
<li>Still inside the coroutine launch, call <code translate="no" dir="ltr">insert()</code> to insert <code translate="no" dir="ltr">newNight</code> into the database. You will see an error, because you have not defined this <code translate="no" dir="ltr">insert()</code> suspend function yet. Note this is not the same <code translate="no" dir="ltr">insert()</code> as the method with the same name in <code translate="no" dir="ltr">SleepDatabaseDAO.kt</code></li>
</ol>
<pre translate="no" dir="ltr">       insert(newNight)
</pre>
<ol type="1" start="5">
<li>Also inside the coroutine launch, update <code translate="no" dir="ltr">tonight</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">       tonight.value = getTonightFromDatabase()
</code></pre>
<ol type="1" start="6">
<li>Below <code translate="no" dir="ltr">onStartTracking()</code>, define <code translate="no" dir="ltr">insert()</code> as a <code translate="no" dir="ltr">private suspend</code> function that takes a <code translate="no" dir="ltr">SleepNight</code> as its argument.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private suspend fun insert(night: SleepNight) {}
</code></pre>
<ol type="1" start="7">
<li>Within the <code translate="no" dir="ltr">insert()</code> method, use the DAO to insert night into the database.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">       database.insert(night)
</code></pre>
<p>Note that a coroutine with Room uses <code translate="no" dir="ltr">Dispatchers.IO</code>, so this will not happen on the main thread.</p>
<ol type="1" start="8">
<li>In the <code translate="no" dir="ltr">fragment_sleep_tracker.xml</code> layout file, add the click handler for <code translate="no" dir="ltr">onStartTracking()</code> to the <code translate="no" dir="ltr">start_button</code> using the magic of data binding that you set up earlier. The <code translate="no" dir="ltr">@{() -&gt;</code> function notation creates a lambda function that takes no arguments and calls the click handler in the <code translate="no" dir="ltr">sleepTrackerViewModel</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">android:onClick=&#34;@{() -&gt; sleepTrackerViewModel.onStartTracking()}&#34;
</code></pre>
<ol type="1" start="9">
<li>Build and run your app. Tap the <strong>Start</strong> button. This action creates data, but you cannot see anything yet. You fix that next.</li>
</ol>
<aside class="special"><p><strong>Important:</strong> Now you should be noticing a pattern:</p>
<ol type="1">
<li>Launch a coroutine that runs on the main UI thread, because the result from that coroutine affects what is displayed in the UI. You can access the <code translate="no" dir="ltr">CoroutineScope</code> of a ViewModel through the <code translate="no" dir="ltr">viewModelScope</code> property of the ViewModel, as shown in the following example:</li>
<li>Call a suspend function to do the long-running work, so that you don&#39;t block the UI thread while waiting for the result.</li>
<li>The result of the long-running work may affect the UI, but its operation is independent from the UI. For efficiency, switch to the I/O dispatcher, (Room generates his code for you). The I/O dispatcher uses a thread pool that&#39;s optimized and set aside for these kinds of operations.</li>
<li>Then call the long running function to do the work.</li>
</ol>
<p>The pattern is shown below.</p>
</aside>
<p><strong>Without Room</strong></p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">fun someWorkNeedsToBeDone {
   viewModelScope.launch {
        suspendFunction()
   }
}

suspend fun suspendFunction() {
   withContext(Dispatchers.IO) {
       longrunningWork()
   }
}
</code></pre>
<p><strong>Using Room</strong></p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">// Using Room
fun someWorkNeedsToBeDone {
   viewModelScope.launch {
        suspendDAOFunction()
   }
}

suspend fun suspendDAOFunction() {
   // No need to specify the Dispatcher, Room uses Dispatchers.IO.
   longrunningDatabaseWork()
}
</code></pre>
<h2 is-upgraded id="step-4:-display-the-data" data-text="Step 4: Display the data">Step 4: Display the data</h2>
<p>In the <code translate="no" dir="ltr">SleepTrackerViewModel.kt</code>, the <code translate="no" dir="ltr">nights</code> variable references <code translate="no" dir="ltr">LiveData</code> because <code translate="no" dir="ltr">getAllNights()</code> in the DAO returns <code translate="no" dir="ltr">LiveData</code>.</p>
<p>It is a <code translate="no" dir="ltr">Room</code> feature that every time the data in the database changes, the <code translate="no" dir="ltr">LiveData</code> <code translate="no" dir="ltr">nights</code> is updated to show the latest data. You never need to explicitly set the <code translate="no" dir="ltr">LiveData</code> or update it. <code translate="no" dir="ltr">Room</code> updates the data to match the database.</p>
<p>However, if you display <code translate="no" dir="ltr">nights</code> in a text view, it will show the object reference. To see the contents of the object, transform the data into a formatted string. Use a <code translate="no" dir="ltr">Transformation</code> map that&#39;s executed every time <code translate="no" dir="ltr">nights</code> receives new data from the database.</p>
<ol type="1">
<li>Open the <code translate="no" dir="ltr">Util.kt</code> file and uncomment the code for the definition of <code translate="no" dir="ltr">formatNights()</code>and the associated <code translate="no" dir="ltr">import</code> statements. To uncomment code in Android Studio, select all the code marked with <code translate="no" dir="ltr">//</code> and press <code translate="no" dir="ltr">Cmd+/</code> or <code translate="no" dir="ltr">Control+/</code>.</li>
<li>Notice <code translate="no" dir="ltr">formatNights()</code> returns a type <code translate="no" dir="ltr">Spanned</code>, which is an HTML-formatted string. This is very convenient because Android&#39;s TextView has the ability to render basic HTML.</li>
<li>Open <strong>res &gt; values &gt; strings.xml</strong>. Notice the use of  <a href="https://www.w3.org/TR/REC-xml/#sec-cdata-sect" target="_blank"><code translate="no" dir="ltr">CDATA</code></a> to format the string resources for displaying the sleep data.</li>
<li>Open <strong>SleepTrackerViewModel.kt</strong>. In the <code translate="no" dir="ltr">SleepTrackerViewModel</code> class, define a variable called <code translate="no" dir="ltr">nights</code>. Get all the nights from the database and assign them to the <code translate="no" dir="ltr">nights</code> variable.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private val nights = database.getAllNights()
</code></pre>
<ol type="1" start="5">
<li>Right below the definition of <code translate="no" dir="ltr">nights</code>, add code to transform <code translate="no" dir="ltr">nights</code> into a <code translate="no" dir="ltr">nightsString</code>. Use the <code translate="no" dir="ltr">formatNights()</code> function from <code translate="no" dir="ltr">Util.kt</code>.</li>
</ol>
<p>Pass <code translate="no" dir="ltr">nights</code> into the  <a href="https://developer.android.com/reference/android/arch/lifecycle/Transformations#map" target="_blank"><code translate="no" dir="ltr">map()</code></a> function from the <code translate="no" dir="ltr">Transformations</code> class. To get access to your string resources, define the mapping function as calling <code translate="no" dir="ltr">formatNights()</code>. Supply <code translate="no" dir="ltr">nights</code> and a <code translate="no" dir="ltr">Resources</code> object.</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">val nightsString = Transformations.map(nights) { nights -&gt;
   formatNights(nights, application.resources)
}
</code></pre>
<ol type="1" start="6">
<li>Open the <code translate="no" dir="ltr">fragment_sleep_tracker.xml</code> layout file. In the <code translate="no" dir="ltr">TextView</code>, in the <code translate="no" dir="ltr">android:text</code> property, you can now replace the resource string with a reference to <code translate="no" dir="ltr">nightsString</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">android:text=&#34;@{sleepTrackerViewModel.nightsString}&#34;
</code></pre>
<ol type="1" start="7">
<li>Rebuild your code and run the app. All your sleep data with start times should display now.</li>
<li>Tap the <strong>Start</strong> button a few more times, and you see more data. <img alt="e6eabf9793d5ab63.png" style="width: 240.90px" src="/codelabs/kotlin-android-training-coroutines-and-room/img/e6eabf9793d5ab63.png"></li>
</ol>
<p>In the next step, you enable functionality for the <strong>Stop</strong> button.</p>
<h2 is-upgraded id="step-5:-add-the-click-handler-for-the-stop-button" data-text="Step 5: Add the click handler for the Stop button">Step 5: Add the click handler for the Stop button</h2>
<p>Using the same pattern as in the previous step, implement the click handler for the <strong>Stop</strong> button in <code translate="no" dir="ltr">SleepTrackerViewModel.</code></p>
<ol type="1">
<li>Add <code translate="no" dir="ltr">onStopTracking()</code> to the <code translate="no" dir="ltr">ViewModel</code>.  Launch a coroutine in the <code translate="no" dir="ltr">viewModelScope</code>. If the end time hasn&#39;t been set yet, set the <code translate="no" dir="ltr">endTimeMilli</code> to the current system time and call <code translate="no" dir="ltr">update()</code> with the night data.</li>
</ol>
<p>In Kotlin, the <code translate="no" dir="ltr">return@</code><em><code translate="no" dir="ltr">label</code></em> syntax specifies the function from which this statement returns, among several nested functions.</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">fun onStopTracking() {
   viewModelScope.launch {
       val oldNight = tonight.value ?: return@launch
       oldNight.endTimeMilli = System.currentTimeMillis()
       update(oldNight)
   }
}
</code></pre>
<ol type="1" start="2">
<li>Implement <code translate="no" dir="ltr">update()</code> using the same pattern as you used to implement <code translate="no" dir="ltr">insert()</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">private suspend fun update(night: SleepNight) {
    database.update(night)
}
</code></pre>
<ol type="1" start="3">
<li>To connect the click handler to the UI, open the <code translate="no" dir="ltr">fragment_sleep_tracker.xml</code> layout file and add the click handler to the <code translate="no" dir="ltr">stop_button</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">android:onClick=&#34;@{() -&gt; sleepTrackerViewModel.onStopTracking()}&#34;
</code></pre>
<ol type="1" start="4">
<li>Build and run your app.</li>
<li>Tap <strong>Start</strong>, then tap <strong>Stop</strong>. You see the start time, end time, sleep quality with no value, and time slept. <img alt="fc7e561d95fd9c02.png" style="width: 264.50px" src="/codelabs/kotlin-android-training-coroutines-and-room/img/fc7e561d95fd9c02.png"></li>
</ol>
<h2 is-upgraded id="step-6:-add-the-click-handler-for-the-clear-button" data-text="Step 6: Add the click handler for the Clear button">Step 6: Add the click handler for the Clear button</h2>
<ol type="1">
<li>Similarly, implement <code translate="no" dir="ltr">onClear()</code> and <code translate="no" dir="ltr">clear()</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">fun onClear() {
   viewModelScope.launch {
       clear()
       tonight.value = null
   }
}

suspend fun clear() {
    database.clear()
}
</code></pre>
<ol type="1" start="2">
<li>To connect the click handler to the UI, open <code translate="no" dir="ltr">fragment_sleep_tracker.xml</code> and add the click handler to the <code translate="no" dir="ltr">clear_button</code>.</li>
</ol>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">android:onClick=&#34;@{() -&gt; sleepTrackerViewModel.onClear()}&#34;
</code></pre>
<ol type="1" start="3">
<li>Build and run your app.</li>
<li>Tap <strong>Clear</strong> to get rid of all the data. Then tap <strong>Start</strong> and <strong>Stop</strong> to make new data.</li>
</ol>


        </google-codelab-step>
      
        <google-codelab-step label="Solution code" duration="0">
          
          <p>Android Studio project:  <a href="https://github.com/google-developer-training/android-kotlin-fundamentals-apps/tree/master/TrackMySleepQualityCoroutines" target="_blank">TrackMySleepQualityCoroutines</a></p>


        </google-codelab-step>
      
        <google-codelab-step label="Summary" duration="0">
          
          <ul>
<li>Use <code translate="no" dir="ltr">ViewModel</code>, <code translate="no" dir="ltr">ViewModelFactory</code>, and data binding to set up the UI architecture for the app.</li>
<li>To keep the UI running smoothly, use coroutines for long-running tasks, such as all database operations.</li>
<li>Coroutines are asynchronous and non-blocking. They use <code translate="no" dir="ltr">suspend</code> functions to make asynchronous code sequential.</li>
<li>When a coroutine calls a function marked with <code translate="no" dir="ltr">suspend</code>, instead of blocking until that function returns like a normal function call, it suspends execution until the result is ready. Then it resumes where it left off with the result.</li>
<li>The difference between <em>blocking</em> and <em>suspending</em> is that if a thread is blocked, no other work happens. If the thread is suspended, other work happens until the result is available.</li>
</ul>
<p>To implement click handlers that trigger database operations, follow this pattern:</p>
<ol type="1">
<li>Launch a coroutine that runs on the main or UI thread, because the result affects the UI.</li>
<li>Call a suspend function to do the long-running work, so that you don&#39;t block the UI thread while waiting for the result.</li>
<li>The long-running work has nothing to do with the UI, so switch to the I/O context. That way, the work can run in a thread pool that&#39;s optimized and set aside for these kinds of operations.</li>
<li>Then call the long running function to do the work.</li>
</ol>
<p>Use a <code translate="no" dir="ltr">Transformations</code> map to create a string from a <code translate="no" dir="ltr">LiveData</code> object every time the object changes.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Learn more" duration="0">
          
          <p>Udacity course:</p>
<ul>
<li><a href="https://www.udacity.com/course/developing-android-apps-with-kotlin--ud9012" target="_blank">Developing Android Apps with Kotlin</a></li>
</ul>
<p>Android Developer Documentation:</p>
<ul>
<li><a href="https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase" target="_blank"><code translate="no" dir="ltr">RoomDatabase</code></a></li>
<li><a href="https://developer.android.com/training/improving-layouts/reusing-layouts" target="_blank">Re-using layouts with &lt;include/&gt;</a></li>
<li><a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModelProvider.Factory" target="_blank"><code translate="no" dir="ltr">ViewModelProvider.Factory</code></a></li>
<li><a href="https://developer.android.com/reference/java/text/SimpleDateFormat" target="_blank"><code translate="no" dir="ltr">SimpleDateFormat</code></a></li>
<li><a href="https://developer.android.com/reference/androidx/core/text/HtmlCompat" target="_blank"><code translate="no" dir="ltr">HtmlCompat</code></a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/coroutines?authuser=1" target="_blank"><code translate="no" dir="ltr">Use Kotlin coroutines with Architecture components</code></a></li>
</ul>
<p>Other documentation and articles:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Factory_method_pattern" target="_blank">Factory pattern</a></li>
<li><a href="https://codelabs.developers.google.com/codelabs/kotlin-coroutines/" target="_blank">Coroutines codelab</a></li>
<li><a href="https://kotlinlang.org/docs/reference/coroutines-overview.html" target="_blank">Coroutines, official documentation</a></li>
<li><a href="https://kotlinlang.org/docs/reference/coroutines/coroutine-context-and-dispatchers.html" target="_blank">Coroutine context and dispatchers</a></li>
<li><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-dispatchers/index.html" target="_blank"><code translate="no" dir="ltr">Dispatchers</code></a></li>
<li><a href="https://medium.com/androiddevelopers/exceed-the-android-speed-limit-b73a0692abc1" target="_blank">Exceed the Android Speed Limit</a></li>
<li><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job/" target="_blank"><code translate="no" dir="ltr">Job</code></a></li>
<li><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/launch.html" target="_blank"><code translate="no" dir="ltr">launch</code></a></li>
<li><a href="https://kotlinlang.org/docs/reference/returns.html#return-at-labels" target="_blank">Returns and jumps in Kotlin</a></li>
<li><a href="http://www.w3.org/TR/REC-xml/#sec-cdata-sect" target="_blank">CDATA</a> stands for  <a href="http://www.w3.org/TR/REC-xml/#dt-chardata" target="_blank"><em>character data</em></a>. CDATA means that the data in between these strings includes data that could be interpreted as XML markup, but should not be.</li>
</ul>


        </google-codelab-step>
      
        <google-codelab-step label="Homework" duration="0">
          
          <p>This section lists possible homework assignments for students who are working through this codelab as part of a course led by an instructor. It&#39;s up to the instructor to do the following:</p>
<ul>
<li>Assign homework if required.</li>
<li>Communicate to students how to submit homework assignments.</li>
<li>Grade the homework assignments.</li>
</ul>
<p>Instructors can use these suggestions as little or as much as they want, and should feel free to assign any other homework they feel is appropriate.</p>
<p>If you&#39;re working through this codelab on your own, feel free to use these homework assignments to test your knowledge.</p>
<h2 is-upgraded id="answer-these-questions" data-text="Answer these questions"><strong>Answer these</strong> <strong>questions</strong></h2>
<h3 is-upgraded id="question-1" data-text="Question 1"><strong>Question 1</strong></h3>
<p>Which of the following is not a benefit of using coroutines?:</p>
<ul>
<li>They are non-blocking</li>
<li>They run asynchronously.</li>
<li>They can be run on a thread other than the main thread.</li>
<li>They always make app runs faster.</li>
<li>They can use exceptions.</li>
<li>They can be written and read as linear code.</li>
</ul>
<h3 is-upgraded id="question-2" data-text="Question 2"><strong>Question 2</strong></h3>
<p>Which of the following is not true for suspend functions.?</p>
<ul>
<li>An ordinary function annotated with the <code translate="no" dir="ltr">suspend</code> keyword.</li>
<li>A function that can be called inside coroutines.</li>
<li>While a suspend function is running, the calling thread is suspended.</li>
<li>Suspend functions must always run in the background.</li>
</ul>
<h3 is-upgraded id="question-3" data-text="Question 3"><strong>Question 3</strong></h3>
<p>Which of the following statements is NOT true?</p>
<ul>
<li>When execution is blocked, no other work can be executed on the blocked thread.</li>
<li>When execution is suspended, the thread can do other work while waiting for the offloaded work to complete.</li>
<li>Suspending is more efficient, because threads may not be waiting, doing nothing.</li>
<li>Whether blocked or suspended, execution is still waiting for the result of the coroutine before continuing.</li>
</ul>


        </google-codelab-step>
      
        <google-codelab-step label="Next codelab" duration="0">
          
          <p>Start to the next lesson:  <a href="https://codelabs.developers.google.com/codelabs/kotlin-android-training-quality-and-states" target="_blank"><paper-button class="colored" raised>Use LiveData to control button states</paper-button></a></p>
<p>For links to other codelabs in this course, see the  <a href="https://codelabs.developers.google.com/android-kotlin-fundamentals/" target="_blank">Android Kotlin Fundamentals codelabs landing page</a>.</p>


        </google-codelab-step>
      
    </google-codelab>
  
    

    
  </div>

  

  
    
    
    
  

  
  
</article>




            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            

<nav class="devsite-footer-promos nocontent" aria-label="Promosi">
  <ul class="devsite-footer-promos-list">
    
    <li class="devsite-footer-promo">
      <a href="//twitter.com/AndroidDev"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer Twitter Promo"
       >
        
        
        <img class="devsite-footer-promo-icon"
             src="/_static/android/images/logo-twitter.svg"
             loading="lazy"
             alt="Twitter">
        
        Twitter
      </a>
      <div class="devsite-footer-promo-description">Ikuti @AndroidDev di Twitter</div>
    </li>
    
    <li class="devsite-footer-promo">
      <a href="//www.youtube.com/user/androiddevelopers"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer YouTube Promo"
       >
        
        
        <img class="devsite-footer-promo-icon"
             src="//www.gstatic.com/images/icons/material/product/2x/youtube_48dp.png"
             loading="lazy"
             alt="YouTube">
        
        YouTube
      </a>
      <div class="devsite-footer-promo-description">Lihat Developer Android di YouTube</div>
    </li>
    
  </ul>
</nav>

          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Link footer">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Selengkapnya tentang Android</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
          
            Android
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/enterprise/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
          
            Enterprise
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/security-center/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
          
            Keamanan
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//source.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
          
            Source
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Dukungan</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=190923&amp;template=841312"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
          
            Laporkan bug platform
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=192697"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
          
            Laporkan bug dokumentasi
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//support.google.com/googleplay/android-developer"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
          
            Google Play support
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://google.qualtrics.com/jfe/form/SV_ewWXIoEVLBcyp7f??reserved=1&amp;utm_source=FooterLink&amp;Q_Language=en&amp;utm_medium=own_srch&amp;utm_campaign=developer.android.com&amp;utm_term=0&amp;utm_content=0&amp;productTag=reg&amp;campaignDate=may19&amp;pType=devel&amp;referral_code=gV420370"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
          
            Bergabung dengan studi riset
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Dokumentasi</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/guide"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
          
            Panduan developer
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/design"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
          
            Panduan desain
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/reference"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
          
            Referensi API
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/samples"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
          
            Sampel
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/studio/intro"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
          
            Android Studio
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  
  
  <nav class="devsite-footer-sites" aria-label="Situs Google Developers lain">
    <a href="https://developers.google.com/"
       class="devsite-footer-sites-logo-link gc-analytics-event"
       data-category="Site-Wide Custom Events"
       data-label="Footer Google Developers Link">
      <img class="devsite-footer-sites-logo"
           src="https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/lockup-developers.svg"
           loading="lazy"
           alt="Google Developers">
    </a>
    <ul class="devsite-footer-sites-list">
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.android.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Android Link"
         
         >
          Android
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.chrome.com/home"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Chrome Link"
         
         >
          Chrome
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//firebase.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Firebase Link"
         
         >
          Firebase
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//cloud.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Google Cloud Platform Link"
         
         >
          Google Cloud Platform
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developers.google.com/products/"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer All products Link"
         
         >
          Semua produk
        </a>
      </li>
      
    </ul>
  </nav>
  

  
  <nav class="devsite-footer-utility-links" aria-label="Link utilitas">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link"
         >
          Privasi
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/license"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link"
         >
          Lisensi
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/distribute/marketing-tools/brand-guidelines"
           data-category="Site-Wide Custom Events"
           data-label="Footer Brand guidelines link"
         >
          Pedoman brand
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Dapatkan berita dan tips melalui email</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/updates"
           data-category="Site-Wide Custom Events"
           data-label="Footer Subscribe link"
         >
          Berlangganan
        </a>
        
      </li>
      
    </ul>
    
    
    
<devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    
    <select aria-label="Pilih preferensi bahasa Anda."
            class="devsite-language-selector-select"
            name="language"
            track-name="click"
            track-type="languageSelector">
    
    
      <option value="en"
              lang="en"
              track-metadata-original-language="id"
              track-metadata-selected-language="en"
              track-name="changed"
              track-type="languageSelector"
            >
        English
      </option>
    
      <option value="id"
              lang="id"
              track-metadata-original-language="id"
              track-metadata-selected-language="id"
              track-name="changed"
              track-type="languageSelector"
            
              selected="selected"
            >
        Bahasa Indonesia
      </option>
    
      <option value="es_419"
              lang="es_419"
              track-metadata-original-language="id"
              track-metadata-selected-language="es_419"
              track-name="changed"
              track-type="languageSelector"
            >
        Español – América Latina
      </option>
    
      <option value="pt_br"
              lang="pt_br"
              track-metadata-original-language="id"
              track-metadata-selected-language="pt_br"
              track-name="changed"
              track-type="languageSelector"
            >
        Português – Brasil
      </option>
    
      <option value="zh_cn"
              lang="zh_cn"
              track-metadata-original-language="id"
              track-metadata-selected-language="zh_cn"
              track-name="changed"
              track-type="languageSelector"
            >
        中文 – 简体
      </option>
    
      <option value="ja"
              lang="ja"
              track-metadata-original-language="id"
              track-metadata-selected-language="ja"
              track-name="changed"
              track-type="languageSelector"
            >
        日本語
      </option>
    
      <option value="ko"
              lang="ko"
              track-metadata-original-language="id"
              track-metadata-selected-language="ko"
              track-name="changed"
              track-type="languageSelector"
            >
        한국어
      </option>
    
    </select>
  </devsite-select>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel></devsite-panel>
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    
<devsite-snackbar 
                  ></devsite-snackbar>

    <devsite-tooltip ></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics enable-analytics-iframe>
      
        <script type="application/json" analytics>[{"gaid": "UA-5831155-1", "dimensions": {"dimension6": "en", "dimension3": false, "dimension4": "Developer Android", "dimension1": "Signed In", "dimension11": false, "dimension5": "id"}, "metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}}]</script>
<script type="application/json" gtm>{"parameters": {"freeTrialEligibleUser": "False", "internalUser": "False", "language": {"machineTranslated": "False", "requested": "id", "served": "en"}, "pageType": "codelab", "projectName": "Developer Android", "signedIn": "True", "tenant": "android", "recommendations": {"sourcePage": "", "sourceType": 0, "sourceRank": 0, "sourceIdenticalDescriptions": 0, "sourceTitleWords": 0, "sourceDescriptionWords": 0, "experiment": ""}}, "tags": ["GTM-KMSWPCJ"]}</script>
      
    </devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
<android-fully-clickable target=".fully-clickable" watch="devsite-content"></android-fully-clickable>
    <script nonce="NK1hob9O6xv9XdS1WE1FImH7Wz0Y6K">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/js/app_loader.js', '[3,"id",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388","https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android","https://android-dot-devsite-v2-prod.appspot.com",1,null,["/_pwa/android/manifest.json","https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/favicon.png","https://www.gstatic.com/devrel-devsite/prod/v854c54f3442b5b06d97cb2bf43f3647f489796c80c33899ecd29b91ae5303388/android/images/lockup.svg","https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,40,50,63,70,75,76,80,87,88,91,92,93,97,98,100,101,102,103,104,105,107,108,111,112,113,115,117,118,120,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,138,147,148],"AIzaSyAP-jjEJBzmIyKR4F-3XITp8yM9T1gEEI8","AIzaSyB6xiKGDR5O3Ak2okS4rLkauxGUG7XP0hg"]')
  
</script>
    <devsite-a11y-announce></devsite-a11y-announce>
  </body>
</html>